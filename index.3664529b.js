var t={};const e=new class{#t;#e;#s;#i;constructor(t=null){this.#i=t?this.#a(t):Array.from({length:4},()=>[,,,,].fill(0)),this.restart()}getState(){return this.#a(this.#t)}getScore(){return this.#e}getStatus(){return this.#s}start(){"idle"===this.#s&&(this.#r(),this.#r(),this.#s="playing")}restart(){this.#t=this.#a(this.#i),this.#e=0,this.#s="idle"}moveLeft(){this.#o("left")}moveRight(){this.#o("right")}moveUp(){this.#o("up")}moveDown(){this.#o("down")}#o(t){if("playing"!==this.#s&&"win"!==this.#s)return;let e=!1;"left"===t||"right"===t?e=this.#h("left"===t):("up"===t||"down"===t)&&(this.#n(),e=this.#h("up"===t),this.#n()),e&&(this.#r(),this.#d())}#h(t){let e=!1;for(let s of this.#t){let i=t?s:[...s].reverse(),{newRow:a,hasMoved:r}=this.#l(i);r&&(e=!0),s.splice(0,4,...t?a:a.reverse())}return e}#l(t){let e=t.filter(t=>0!==t),s=[,,,,].fill(0),i=!1,a=0;for(let r=0;r<e.length;r++)e[r]===e[r+1]?(s[a++]=2*e[r],this.#e+=2*e[r],2048===s[a-1]&&(this.#s="win"),r++,i=!0):(s[a++]=e[r],s[a-1]!==t[a-1]&&(i=!0));return{newRow:s,hasMoved:i}}#r(){let t=[];if(this.#t.forEach((e,s)=>e.forEach((e,i)=>{0===e&&t.push({i:s,j:i})})),t.length>0){let{i:e,j:s}=t[Math.floor(Math.random()*t.length)];this.#t[e][s]=.9>Math.random()?2:4}}#d(){"win"===this.#s||this.#c()||(this.#s="lose")}#c(){return this.#t.some((t,e)=>t.some((s,i)=>0===s||i<3&&s===t[i+1]||e<3&&s===this.#t[e+1][i]))}#n(){this.#t=this.#t[0].map((t,e)=>this.#t.map(t=>t[e]))}#a(t){return t.map(t=>[...t])}};new class{constructor(t){function e(){this.fieldCells.forEach(t=>{t.classList.add("bounce")}),this.fieldCells.forEach(t=>{t.addEventListener("animationend",()=>{t.classList.remove("bounce")},{once:!0})})}this.game=t,this.scoreElement=document.querySelector(".game-score"),this.gameField=document.querySelector(".game-field"),this.fieldCells=document.querySelectorAll(".field-cell"),this.startButton=document.querySelector(".button.start"),this.restartButton=document.querySelector(".button.restart"),this.loseMessage=document.querySelector(".message-lose"),this.winMessage=document.querySelector(".message-win"),this.startMessage=document.querySelector(".message-start"),this.startButton.addEventListener("click",this.startGame.bind(this)),this.startButton.addEventListener("click",e.bind(this)),this.restartButton.addEventListener("click",this.restartGame.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),this.restartButton.addEventListener("click",e.bind(this)),this.renderField(),this.updateScore(),this.showStartMessage()}renderField(){let t=this.game.getState();this.fieldCells.forEach((e,s)=>{let i=t[Math.floor(s/4)][s%4];e.className="field-cell",0!==i?(e.classList.add(`field-cell--${i}`),e.textContent=i):e.textContent=""})}updateScore(){this.scoreElement.textContent=this.game.getScore()}resetMessages(){this.loseMessage.classList.add("hidden"),this.winMessage.classList.add("hidden"),this.startMessage.classList.add("hidden")}showStartMessage(){this.startMessage.classList.remove("hidden")}startGame(){this.game.start(),this.renderField(),this.updateScore(),this.resetMessages(),this.restartButton.classList.remove("hidden"),this.startButton.classList.add("hidden")}restartGame(){this.game.restart(),this.startGame()}handleKeyDown(t){if("playing"!==this.game.getStatus()&&"win"!==this.game.getStatus())return;let e={ArrowLeft:"moveLeft",ArrowRight:"moveRight",ArrowUp:"moveUp",ArrowDown:"moveDown"}[t.key];e&&(this.game[e](),this.renderField(),this.updateScore(),this.checkGameStatus())}checkGameStatus(){"win"===this.game.getStatus()?this.winMessage.classList.remove("hidden"):"lose"===this.game.getStatus()&&(this.loseMessage.classList.remove("hidden"),this.restartButton.classList.remove("hidden"),this.startButton.classList.add("hidden"))}}(e);
//# sourceMappingURL=index.3664529b.js.map
